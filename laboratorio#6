#include <iostream>
#include <string>
using namespace std;

struct Direccion {
    string calle;
    int numero;
    string ciudad;
};

struct Estudiante {
    string nombre;
    int edad;
    float calificaciones[5];
    Direccion direccion;
};

void ingresarEstudiantes(Estudiante* &estudiantes, int &numEstudiantes);
void mostrarEstudiantes(Estudiante* estudiantes, int numEstudiantes);
int buscarEstudiante(Estudiante* estudiantes, int numEstudiantes, string nombre);
void modificarEstudiante(Estudiante* estudiantes, int numEstudiantes);

int main() {
    Estudiante* estudiantes = nullptr;
    int numEstudiantes = 0;
    int opcion;

    do {
        cout << "\n=== MENU PRINCIPAL ===\n";
        cout << "1. Ingresar estudiantes\n";
        cout << "2. Mostrar estudiantes\n";
        cout << "3. Buscar estudiante\n";
        cout << "4. Modificar estudiante\n";
        cout << "5. Salir\n";
        cout << "Seleccione una opcion: ";
        cin >> opcion;
        cin.ignore(); 
        switch (opcion) {
            case 1:
                ingresarEstudiantes(estudiantes, numEstudiantes);
                break;
            case 2:
                mostrarEstudiantes(estudiantes, numEstudiantes);
                break;
            case 3: {
                string nombre;
                cout << "Ingrese el nombre del estudiante a buscar: ";
                getline(cin, nombre);
                int pos = buscarEstudiante(estudiantes, numEstudiantes, nombre);
                if (pos != -1) {
                    cout << "\n--- Estudiante encontrado ---\n";
                    cout << "Nombre: " << estudiantes[pos].nombre << endl;
                    cout << "Edad: " << estudiantes[pos].edad << endl;
                    cout << "Calificaciones: ";
                    for (float nota : estudiantes[pos].calificaciones) {
                        cout << nota << " ";
                    }
                    cout << "\nDireccion: " 
                         << estudiantes[pos].direccion.calle << " #" 
                         << estudiantes[pos].direccion.numero << ", " 
                         << estudiantes[pos].direccion.ciudad << endl;
                } else {
                    cout << "Estudiante no encontrado.\n";
                }
                break;
            }
            case 4:
                modificarEstudiante(estudiantes, numEstudiantes);
                break;
            case 5:
                cout << "Saliendo del programa...\n";
                break;
            default:
                cout << "Opcion invalida.\n";
        }

    } while (opcion != 5);

    delete[] estudiantes;
    return 0;
}

void ingresarEstudiantes(Estudiante* &estudiantes, int &numEstudiantes) {
    int nuevos;
    cout << "Â¿Cuantos estudiantes desea ingresar? ";
    cin >> nuevos;
    cin.ignore();

    Estudiante* nuevoArreglo = new Estudiante[numEstudiantes + nuevos];

    for (int i = 0; i < numEstudiantes; i++) {
        nuevoArreglo[i] = estudiantes[i];
    }

    for (int i = numEstudiantes; i < numEstudiantes + nuevos; i++) {
        cout << "\n--- Ingresando estudiante #" << (i + 1) << " ---\n";
        cout << "Nombre: ";
        getline(cin, nuevoArreglo[i].nombre);
        cout << "Edad: ";
        cin >> nuevoArreglo[i].edad;
        cin.ignore();

        cout << "Ingrese 5 calificaciones: ";
        for (int j = 0; j < 5; j++) {
            cin >> nuevoArreglo[i].calificaciones[j];
        }
        cin.ignore();

        cout << "Calle: ";
        getline(cin, nuevoArreglo[i].direccion.calle);
        cout << "Numero: ";
        cin >> nuevoArreglo[i].direccion.numero;
        cin.ignore();
        cout << "Ciudad: ";
        getline(cin, nuevoArreglo[i].direccion.ciudad);
    }

    delete[] estudiantes;
    estudiantes = nuevoArreglo;
    numEstudiantes += nuevos;

    cout << "\nEstudiantes ingresados correctamente.\n";
}

void mostrarEstudiantes(Estudiante* estudiantes, int numEstudiantes) {
    if (numEstudiantes == 0) {
        cout << "No hay estudiantes registrados.\n";
        return;
    }

    cout << "\n=== LISTA DE ESTUDIANTES ===\n";
    for (int i = 0; i < numEstudiantes; i++) {
        cout << "\nEstudiante #" << (i + 1) << endl;
        cout << "Nombre: " << estudiantes[i].nombre << endl;
        cout << "Edad: " << estudiantes[i].edad << endl;
        cout << "Calificaciones: ";
        for (float nota : estudiantes[i].calificaciones)
            cout << nota << " ";
        cout << "\nDireccion: " << estudiantes[i].direccion.calle << " #" 
             << estudiantes[i].direccion.numero << ", " 
             << estudiantes[i].direccion.ciudad << endl;
    }
}

int buscarEstudiante(Estudiante* estudiantes, int numEstudiantes, string nombre) {
    for (int i = 0; i < numEstudiantes; i++) {
        if (estudiantes[i].nombre == nombre) {
            return i;
        }
    }
    return -1;
}

void modificarEstudiante(Estudiante* estudiantes, int numEstudiantes) {
    if (numEstudiantes == 0) {
        cout << "No hay estudiantes registrados.\n";
        return;
    }

    string nombre;
    cout << "Ingrese el nombre del estudiante a modificar: ";
    getline(cin, nombre);

    int pos = buscarEstudiante(estudiantes, numEstudiantes, nombre);
    if (pos == -1) {
        cout << "Estudiante no encontrado.\n";
        return;
    }

    cout << "\n--- Modificando datos de " << estudiantes[pos].nombre << " ---\n";
    cout << "Nuevo nombre: ";
    getline(cin, estudiantes[pos].nombre);
    cout << "Nueva edad: ";
    cin >> estudiantes[pos].edad;
    cin.ignore();

    cout << "Ingrese 5 nuevas calificaciones: ";
    for (int j = 0; j < 5; j++) {
        cin >> estudiantes[pos].calificaciones[j];
    }
    cin.ignore();

    cout << "Nueva calle: ";
    getline(cin, estudiantes[pos].direccion.calle);
    cout << "Nuevo numero: ";
    cin >> estudiantes[pos].direccion.numero;
    cin.ignore();
    cout << "Nueva ciudad: ";
    getline(cin, estudiantes[pos].direccion.ciudad);

    cout << "\nDatos modificados correctamente.\n";
}
